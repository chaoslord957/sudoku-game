<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Neon Sudoku</title>
  <style>
    #loginCanvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 1;
  pointer-events: none; /* allows clicks to pass through */
}
#loginBox {
  position: relative;
  z-index: 2; /* ensures it's above the canvas */
}


    #loginPage {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(18deg, #c00f96, #0d24cc);
  z-index: 0;
}
#loginBox {
  background: rgba(47, 49, 180, 0.1);
  padding: 2rem;
  border-radius: 12px;
  text-align: center;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  color: white;
}
#loginBox input {
  padding: 0.6rem;
  width: 80%;
  background: linear-gradient(135deg, #1a2cd2, #e40202);
  font-size: 1rem;
  border: none;
  border-radius: 6px;
}
#loginBox button {
  padding: 0.6rem 1.2rem;
  font-size: 1rem;
  border: none;
  border-radius: 6px;
  background: #ccff00;
  cursor: pointer;
}
#loginBox button:hover {
  background: #d4ff00;
}
#userDisplay {
  position: absolute;
  top: 10px;
  right: 20px;
  color: white;
  font-weight: bold;
  font-size: 1rem;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}
    /* RESET + BODY */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      font-family: sans-serif;
      
      position: relative;
    }

    /* Canvas sits behind everything */
    #bgCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: -1;
    }

    /* FULL-PAGE MENU */
    #menu {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      gap: 1rem;
      padding: 2rem 0;
    }
    #menu button {
      width: 80%;
      max-width: 400px;
      height: 15vh;
      min-height: 80px;
      border: none;
      font-size: 2rem;
      font-weight: bold;
      color: #000;
      background: linear-gradient(135deg, #10900e, #f7ff05);
      transition: background 0.3s;
      cursor: pointer;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #menu button:hover {
      background: linear-gradient(135deg, #ccff00, #39ff14);
    }

    /* GAME SCREEN */
    #game {
      display: none;
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      overflow: auto;
      padding: 2rem;
    }
    #stats {
      display: flex;
      justify-content: center;
      gap: 2rem;
      color: #fff;
      font-size: 1.2rem;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    #game button {
      margin: .5rem;
      padding: .6rem 1.2rem;
      border: none;
      border-radius: 4px;
      background: rgba(255,255,255,0.8);
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s;
    }
    #game button:hover {
      background: rgba(255,255,255,1);
    }

    /* SUDOKU BOARD */
    table {
      border-collapse: collapse;
      margin: 1rem auto;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
      background: rgba(255,255,255,0.9);
      border-radius: 8px;
      overflow: hidden;
    }
    td {
      width: 3rem; height: 3rem;
      border: 1px solid #999;
      background: #fff;
      text-align: center;
      vertical-align: middle;
      transition: background 0.2s;
    }
    td:nth-child(3n) { border-right: 3px solid #333; }
    tr:nth-child(3n) td { border-bottom: 3px solid #333; }
    td:first-child { border-left: 3px solid #333; }
    tr:first-child td { border-top: 3px solid #333; }

    /* HOVER EFFECT ON CELLS */
    #board td:hover {
      background: #ccff00;
    }

    .fixed {
      font-weight: bold;
      background: #e0e0e0;
    }

    input {
      width: 100%; height: 100%;
      border: none;
      text-align: center;
      font-size: 1.2rem;
      background: transparent;
    }
    input:focus {
      outline: 2px solid #66f;
    }

    /* SIMPLE MODAL */
    #modal-overlay {
      position: fixed; top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #modal {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    #modal p {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #333;
    }
    #modal button {
      padding: 8px 16px;
      background: #ff0080;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    #modal button:hover {
      background: #e60073;
    }
  </style>
</head>
<body>
  
    <div id="loginPage">
      <canvas id="loginCanvas"></canvas>
  <div id="loginBox">
    <h2>Welcome to Sudoku<br><br></h2>
    <input id="username" type="text" placeholder="Username"
 /><br/><br/>
    <input id="password" type="password" placeholder="Password" /><br/><br/>
    <button onclick="handleLogin()">Submit</button>

    <p style="margin-top: 1rem; font-size: 0.9rem;">
  New user? <a href="signup.html" style="color: #ccff00; text-decoration: underline;">Register here!</a>
</p>
  </div>
</div>
  <canvas id="bgCanvas"></canvas>

  <div id="modal-overlay">
    <div id="modal">
      <p id="modal-msg"></p>
      <button id="modal-ok">OK</button>
    </div>
  </div>

  <div id="menu">
    <button data-level="easy">Easy</button>
    <button data-level="medium">Medium</button>
    <button data-level="hard">Hard</button>
  </div>

  <div id="game">
    <div id="stats">
      <div id="timer">Time: 00:00</div>
      <div id="xp-box">XP: 0</div>
    </div>
    <button id="back">‚Üê Back</button>
    <button id="regen">Regenerate</button>
    <table id="board"></table>
  </div>

  <script>
    (function(){
  const canvas = document.getElementById('loginCanvas');
  const ctx = canvas.getContext('2d');
  const colors = ['#ff77a9','#77aaff'];
  let particles = [];

  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    initParticles();
  }

  function initParticles(){
    particles = [];
    for(let i=0; i<60; i++){
      particles.push({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: 2 + Math.random()*4,
        vx: -0.3 + Math.random()*0.6,
        vy: 0.2 + Math.random()*0.4,
        color: colors[Math.floor(Math.random()*colors.length)]
      });
    }
  }

  function draw(){
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for(let p of particles){
      p.x += p.vx;
      p.y += p.vy;
      if(p.y - p.r > canvas.height) p.y = -p.r;
      if(p.x - p.r > canvas.width)  p.x = -p.r;
      if(p.x + p.r < 0)             p.x = canvas.width + p.r;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = p.color;
      ctx.fill();
    }
    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', resize);
  resize();
  draw();
})();
    let currentUser = '';

function handleLogin() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if (!user || !pass) {
    alert('Please enter both username and password.');
    return;
  }
  currentUser = user;
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('menu').style.display = 'flex';
  showUsername();
}

function showUsername() {
  let display = document.getElementById('userDisplay');
  if (!display) {
    display = document.createElement('div');
    display.id = 'userDisplay';
    document.body.appendChild(display);
  }
  display.textContent = `üë§ ${currentUser}`;
}
    // ‚Äî‚Äî‚Äî BACKGROUND PARTICLES ‚Äî‚Äî‚Äî
    (function(){
      const canvas = document.getElementById('bgCanvas'),
            ctx    = canvas.getContext('2d'),
            colors = ['#ff77a9','#77aaff'];
      let parts = [];

      function resize(){
        canvas.width = innerWidth;
        canvas.height = innerHeight;
        init();
      }
      function init(){
        parts = [];
        for(let i=0; i<60; i++){
          parts.push({
            x: Math.random()*canvas.width,
            y: Math.random()*canvas.height,
            r: 2 + Math.random()*4,
            vx: -0.3 + Math.random()*0.6,
            vy: 0.2 + Math.random()*0.4,
            col: colors[Math.floor(Math.random()*colors.length)]
          });
        }
      }
      function draw(){
        // Draw gradient background directly on canvas
const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
gradient.addColorStop(0, '#0081ea');
gradient.addColorStop(1, '#c71720');
ctx.fillStyle = gradient;
ctx.fillRect(0, 0, canvas.width, canvas.height);
        for(let p of parts){
          p.x += p.vx; p.y += p.vy;
          if(p.y - p.r > canvas.height) p.y = -p.r;
          if(p.x - p.r > canvas.width)  p.x = -p.r;
          if(p.x + p.r < 0)             p.x = canvas.width + p.r;
          ctx.beginPath();
          ctx.arc(p.x,p.y,p.r,0,2*Math.PI);
          ctx.fillStyle = p.col;
          ctx.fill();
        }
        requestAnimationFrame(draw);
      }
      window.addEventListener('resize', resize);
      resize();
      draw();
    })();

    // ‚Äî‚Äî‚Äî MODAL UTILITY ‚Äî‚Äî‚Äî
    const overlay = document.getElementById('modal-overlay'),
          msgEl   = document.getElementById('modal-msg'),
          okBtn   = document.getElementById('modal-ok');
    function showModal(html){
      msgEl.innerHTML = html;
      overlay.style.display = 'flex';
    }
    okBtn.onclick = () => overlay.style.display = 'none';

    // ‚Äî‚Äî‚Äî SUDOKU + TIMER + XP LOGIC ‚Äî‚Äî‚Äî
    const settings = {
      easy:   { clues:45, reward:100 },
      medium: { clues:34, reward:300 },
      hard:   { clues:30, reward:500 }
    };
    let lvl, puzzleGrid, solutionGrid;
    let xp=0, mistakes=0, time=0, timerID;

    const menu  = document.getElementById('menu'),
          game  = document.getElementById('game'),
          board = document.getElementById('board'),
          back  = document.getElementById('back'),
          regen = document.getElementById('regen'),
          timer = document.getElementById('timer'),
          xpBox = document.getElementById('xp-box');

    menu.addEventListener('click', e => {
      if(!e.target.dataset.level) return;
      lvl = e.target.dataset.level;
      startGame();
    });
    back.addEventListener('click', endGame);
    regen.addEventListener('click', startGame);

    function startGame(){
      mistakes = 0;
      resetTimer();
      updateXp();
      const { puzzle, solution } = generatePuzzle(lvl);
      puzzleGrid = puzzle;
      solutionGrid = solution;
      render(puzzleGrid);
      menu.style.display = 'none';
      game.style.display = 'block';
    }
    function endGame(){
      clearInterval(timerID);
      board.innerHTML = '';
      game.style.display = 'none';
      menu.style.display = 'flex';
    }

    function resetTimer(){
      clearInterval(timerID);
      time = 0;
      updateTimer();
      timerID = setInterval(()=>{
        time++;
        updateTimer();
      },1000);
    }
    function updateTimer(){
      const mm = String(Math.floor(time/60)).padStart(2,'0'),
            ss = String(time%60).padStart(2,'0');
      timer.textContent = `Time: ${mm}:${ss}`;
    }
    function updateXp(){
      xpBox.textContent = `XP: ${xp}`;
    }

    function render(grid){
      board.innerHTML = '';
      for(let r=0; r<9; r++){
        const row = board.insertRow();
        for(let c=0; c<9; c++){
          const cell = row.insertCell();
          const v = grid[r][c];
          if(v){
            cell.textContent = v;
            cell.classList.add('fixed');
          } else {
            const inp = document.createElement('input');
            inp.maxLength = 1;
            inp.addEventListener('input', ()=> onInput(inp,r,c));
            cell.appendChild(inp);
          }
        }
      }
    }

    function onInput(inp,r,c){
      const v = inp.value.replace(/[^1-9]/g,'');
      if(!v){
        inp.value = '';
        return;
      }
      if(conflict(puzzleGrid,r,c,v)){
        mistakes++;
        xp -= 2;
        updateXp();
        showModal('Number already exists!');
        inp.value = '';
        return;
      }
      inp.value = v;
      puzzleGrid[r][c] = +v;
      checkWin();
    }

    function conflict(g,r,c,v){
      v = +v;
      for(let i=0;i<9;i++){
        if(i!==c && g[r][i]===v) return true;
        if(i!==r && g[i][c]===v) return true;
      }
      const br = 3*Math.floor(r/3), bc = 3*Math.floor(c/3);
      for(let i=br;i<br+3;i++){
        for(let j=bc;j<bc+3;j++){
          if((i!==r||j!==c) && g[i][j]===v) return true;
        }
      }
      return false;
    }

    function checkWin(){
      for(let r=0;r<9;r++){
        for(let c=0;c<9;c++){
          if(puzzleGrid[r][c]===0) return;
        }
      }
      clearInterval(timerID);
      xp += settings[lvl].reward;
      updateXp();
      const mm = String(Math.floor(time/60)).padStart(2,'0'),
            ss = String(time%60).padStart(2,'0');
      showModal(
        `üéâ Completed ${lvl}!<br>` +
        `Time: ${mm}:${ss}<br>` +
        `Mistakes: ${mistakes}<br>` +
        `+${settings[lvl].reward} XP`
      );
    }

    // PUZZLE GENERATOR & SOLVER
    function generatePuzzle(level){
      const full = generateSolution();
      const puzzle = full.map(r=>r.slice());
      digHoles(puzzle, settings[level].clues);
      return { puzzle, solution: full };
    }

    function generateSolution(){
      const grid = Array.from({length:9},()=>Array(9).fill(0));
      backtrack(grid,0,0);
      return grid;
    }
    function backtrack(g,r,c){
      if(r===9) return true;
      const [nr,nc] = c===8 ? [r+1,0] : [r,c+1];
      for(let v of shuffle([1,2,3,4,5,6,7,8,9])){
        if(!conflict(g,r,c,v)){
          g[r][c] = v;
          if(backtrack(g,nr,nc)) return true;
        }
      }
      g[r][c] = 0;
      return false;
    }

    function digHoles(g,clues){
      let holes = 81 - clues, attempts = holes * 5;
      while(holes>0 && attempts--> 0){
        const r = Math.floor(Math.random()*9),
              c = Math.floor(Math.random()*9);
        if(g[r][c]===0) continue;
        const backup = g[r][c];
        g[r][c] = 0;
        const copy = g.map(row=>row.slice());
        if(countSolutions(copy,2)!==1) {
          g[r][c] = backup;
        } else {
          holes--;
        }
      }
    }

    function countSolutions(g,lim){ return solveCount(g,0,0,lim); }
    function solveCount(g,r,c,lim){
      if(r===9) return 1;
      const [nr,nc] = c===8 ? [r+1,0] : [r,c+1];
      if(g[r][c]!==0) return solveCount(g,nr,nc,lim);
      let tot=0;
      for(let v=1;v<=9;v++){
        if(!conflict(g,r,c,v)){
          g[r][c] = v;
          tot += solveCount(g,nr,nc,lim-tot);
          if(tot>=lim){
            g[r][c] = 0;
            return tot;
          }
          g[r][c] = 0;
        }
      }
      return tot;
    }

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    
const BASE_URL = "http://localhost:5000"; // later replace with your deployed backend URL

async function handleLogin() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
        showModal("Please enter both username and password!");
        return;
    }

    try {
        const res = await fetch(`${BASE_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const data = await res.json();

        if (res.status === 200) {
            showModal("Login successful ‚úÖ");
            localStorage.setItem("username", username); // save user info
            document.getElementById("loginPage").style.display = "none";
            document.getElementById("menu").style.display = "flex";
        } else {
            showModal(data.message); // show backend error
        }
    } catch (err) {
        console.error(err);
        showModal("Server error, try again later!");
    }
}

// modal utility
function showModal(msg) {
    const overlay = document.getElementById("modal-overlay");
    const modalMsg = document.getElementById("modal-msg");
    overlay.style.display = "flex";
    modalMsg.textContent = msg;

    document.getElementById("modal-ok").onclick = () => {
        overlay.style.display = "none";
    };
}



// Function to show modal messages
function showModal(msg) {
    const overlay = document.getElementById("modal-overlay");
    const modalMsg = document.getElementById("modal-msg");
    overlay.style.display = "block";
    modalMsg.textContent = msg;

    document.getElementById("modal-ok").onclick = () => {
        overlay.style.display = "none";
    };
}

  </script>
</body>
</html>
